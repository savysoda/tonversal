<!DOCTYPE html>
<html>
<!--  <head>-->
<!--    <meta charset="utf-8">-->
<!--    <script src="https://unpkg.com/@tonconnect/sdk@latest/dist/tonconnect-sdk.min.js" defer></script>-->
<!--  </head>-->
  <body onload="onLoad()">

  <h1>Login to MirrorPlant via Telegram</h1>


  <script async src="https://telegram.org/js/telegram-widget.js?21" data-telegram-login="ss_mp_bot" data-size="large" data-onauth="onTelegramAuth(user)" data-request-access="write"></script>
  <script type="text/javascript">

    let intent;
    function onLoad() {
      const params = new Proxy(new URLSearchParams(window.location.search), {
        get: (searchParams, prop) => searchParams.get(prop),
      });
// Get the value of "some_key" in eg "https://example.com/?some_key=some_value"
      intent = params.intent; // "some_value"
      if(!intent) {
        alert("Intent is needed");
      }else {
        console.log(intent)
      }

    }
    function onTelegramAuth(user) {
      console.log("login in as " + JSON.stringify(user));
      console.log(`xxxschame://${intent}?` + btoa(JSON.stringify(user)));
      window.location = `xxxschame://${intent}?` + btoa(JSON.stringify(user));
    }
  </script>
  </body>
</html>
